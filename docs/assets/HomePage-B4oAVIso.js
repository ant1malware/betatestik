import{j as e}from"./index-u8bQzdMu.js";import{R as c,L as B}from"./react-vendor-DTkXckhQ.js";import{t as D,s as H,M as T,c as P,V as W,W as $,Y,U as z,Z as V}from"./icons-DpAAz4P9.js";const k=800,L="chat:nick",I=["Скай-Страж","Право-Самурай","Пульс-Рейдер","Кибер-Медик","Неон-Тактик","Астрал-Офицер","Фантом-Лечащий","Шифр-Инспектор","Квант-Боец","Пиксель-Волк","Туман-Командор","Искра-Наблюдатель","Нуль-Гравитация","Полярный Пилот","Городской Хирург","Сыворотка-Vibe","Стерильный Ниндзя","Скальпель-Облако","Рентген-Панк","Ватка-Supreme"];function M(){const n=I[Math.floor(Math.random()*I.length)],a=Math.floor(Math.random()*900+100);return`${n} #${a}`}function q(n){try{return typeof n=="string"?JSON.parse(n):n instanceof ArrayBuffer?JSON.parse(new TextDecoder().decode(n)):(typeof Blob<"u"&&n instanceof Blob,null)}catch{return null}}function F(n){return new Date(n).toLocaleTimeString(void 0,{hour12:!1})}const Q=`
.rc-wrap{border:1px solid #111;background:#111;border-radius:4px;overflow:hidden;font:13px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, "Apple Color Emoji","Segoe UI Emoji";}
.rc-head{padding:6px 8px;color:#c9d1d9;background:#0e0e0f;border-bottom:1px solid #0b0b0b;display:flex;justify-content:space-between;align-items:center}
.rc-head .pill{display:inline-flex;align-items:center;gap:6px;border-radius:10px;padding:2px 8px;font-size:12px}
.rc-pill-online{background:#193a2b;color:#7ee787;border:1px solid #2ea04344}
.rc-pill-admin{background:#1a2438;color:#79c0ff;border:1px solid #79c0ff33}
.rc-list{height:280px;overflow:auto;background:#1a1a1b}
.rc-list ul{list-style:none;margin:0;padding:0}
.rc-list li{padding:3px 8px;white-space:pre-wrap;word-break:break-word}
.rc-list li:nth-child(odd){background:#232324}
.rc-list li:nth-child(even){background:#1e1e1f}
.rc-ts{color:#9da1a6;margin-right:6px}
.rc-me{color:#a3d977;font-weight:600}
.rc-other{color:#e06c75;font-weight:600}
.rc-admin{color:#facc15;font-weight:700}
.rc-form{display:flex;gap:6px;padding:6px;background:#0f0f10;border-top:1px solid #0b0b0b}
.rc-input{flex:1;background:#0f0f10;border:1px solid #2a2a2b;color:#e5e7eb;border-radius:4px;padding:6px 8px}
.rc-btn{background:#2b2b2c;border:1px solid #3a3a3c;color:#e5e7eb;border-radius:4px;padding:6px 10px;cursor:pointer}
.rc-btn:disabled{opacity:.6;cursor:not-allowed}
.rc-actions{display:flex;gap:4px;margin-left:8px}
.rc-ax{font-size:12px;background:#2b2b2c;border:1px solid #3a3a3c;color:#ccc;border-radius:4px;padding:2px 6px;cursor:pointer}
.rc-empty{opacity:.7;padding:6px 8px}
`;function X({room:n="global",className:a}){const u="wss://notifications-worker.wizardiowhy.workers.dev/chat",[f,v]=c.useState(!1),[m,C]=c.useState(!1),[E,R]=c.useState(""),[w,p]=c.useState([]),h=c.useRef(null),A=c.useRef(null),b=c.useRef({}),[g]=c.useState(()=>{try{const t=localStorage.getItem(L);if(t)return t;const r=M();return localStorage.setItem(L,r),r}catch{return M()}});c.useEffect(()=>{const t=A.current;t&&(t.scrollTop=t.scrollHeight)},[w.length]),c.useEffect(()=>{let t=!1,r=0;const d=()=>{if(t)return;const l=new URL(u);l.searchParams.set("room",n);const i=new WebSocket(l);h.current=i,i.addEventListener("open",()=>{v(!0),r=0,i.send(JSON.stringify({type:"hello",name:g}))}),i.addEventListener("message",async N=>{try{let s=q(N.data);if(!s&&typeof Blob<"u"&&N.data instanceof Blob&&(s=JSON.parse(await N.data.text())),!s)return;if(s.type==="history")p(s.messages);else if(s.type==="message"){const x=s.cid;if(x&&b.current[x]){const o=b.current[x];delete b.current[x],p(j=>{const y=j.filter(S=>S.id!==o);return y.some(S=>S.id===s.message.id)?y:[...y,s.message]})}else p(o=>o.some(j=>j.id===s.message.id)?o:[...o,s.message])}else s.type==="delete"?p(x=>x.filter(o=>o.id!==s.id)):s.type==="edit"?p(x=>x.map(o=>o.id===s.id?{...o,text:s.text}:o)):s.type==="system"&&(s.text==="admin-ok"&&C(!0),s.text==="hello-ok"&&C(!1))}catch{}});const K=()=>{v(!1),!t&&(r=Math.min(r+1,6),setTimeout(d,400*r))};i.addEventListener("close",K),i.addEventListener("error",()=>i.close())};return d(),()=>{var l;t=!0;try{(l=h.current)==null||l.close()}catch{}}},[u,n,g]);function O(){const t=E.replace(/\s+/g," ").trim(),r=h.current;if(!t||!r||r.readyState!==WebSocket.OPEN)return;const d=`${Date.now()}_${Math.random().toString(36).slice(2)}`,l=`loc_${d}`;b.current[d]=l,p(i=>[...i,{id:l,author:m?"Admin":g,text:t,ts:Date.now()}]),r.send(JSON.stringify({type:"message",text:t.slice(0,k),cid:d})),R("")}const U=t=>{const r=h.current;!m||!r||r.readyState!==WebSocket.OPEN||r.send(JSON.stringify({type:"delete",id:t}))},_=(t,r)=>{var i;const d=h.current;if(!m||!d||d.readyState!==WebSocket.OPEN)return;const l=(i=prompt("Изменить сообщение:",r))==null?void 0:i.trim();l&&d.send(JSON.stringify({type:"edit",id:t,text:l.slice(0,k)}))},J=t=>t==="Admin"?"rc-admin":t===g?"rc-me":"rc-other";return e.jsxs("div",{className:a??"",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:Q}}),e.jsxs("div",{className:"rc-wrap",children:[e.jsxs("div",{className:"rc-head",children:[e.jsx("div",{children:"Chat"}),e.jsxs("div",{children:[e.jsx("span",{className:`pill ${f?"rc-pill-online":""}`,children:f?"online":"offline"}),m&&e.jsx("span",{className:"pill rc-pill-admin",style:{marginLeft:6},children:"Admin"})]})]}),e.jsx("div",{ref:A,className:"rc-list",children:w.length===0?e.jsx("div",{className:"rc-empty",children:"…"}):e.jsx("ul",{children:w.map(t=>e.jsxs("li",{children:[e.jsxs("span",{className:"rc-ts",children:["[",F(t.ts),"]"]}),e.jsx("span",{className:J(t.author),children:t.author}),e.jsx("span",{children:": "}),e.jsx("span",{children:t.text}),m&&e.jsxs("span",{className:"rc-actions",children:[e.jsx("button",{className:"rc-ax",onClick:()=>_(t.id,t.text),children:"Ред."}),e.jsx("button",{className:"rc-ax",onClick:()=>U(t.id),children:"Удал."})]})]},t.id))})}),e.jsxs("form",{className:"rc-form",onSubmit:t=>{t.preventDefault(),O()},children:[e.jsx("input",{className:"rc-input",placeholder:"напишите сообщение…",value:E,onChange:t=>R(t.target.value),maxLength:k,disabled:!f}),e.jsx("button",{type:"submit",className:"rc-btn",disabled:!f,children:"▶"})]})]})]})}const Z=[{icon:e.jsx(Y,{className:"w-5 h-5"}),title:"Безопасность",text:"Все данные передаются по HTTPS. Админ — только по секретной ссылке."},{icon:e.jsx(z,{className:"w-5 h-5"}),title:"Комьюнити",text:"Общий чат с рандомными никами — без регистрации."},{icon:e.jsx(V,{className:"w-5 h-5"}),title:"Обновления",text:"Лента уведомлений из Telegram (KV хранит последние 100)."},{icon:e.jsx(T,{className:"w-5 h-5"}),title:"Модерация",text:"Админ может редактировать и удалять сообщения."}],G=[{to:"/faq",label:"FAQ",icon:e.jsx(P,{className:"w-4 h-4"})},{to:"/rules",label:"Правила",icon:e.jsx(W,{className:"w-4 h-4"})},{to:"/news",label:"Новости",icon:e.jsx($,{className:"w-4 h-4"})}];function re(){const n=c.useRef(null);return c.useEffect(()=>{document.title="Правительство — Памятка (SKY)"},[]),e.jsxs("main",{className:"min-h-screen bg-[#0a0b0d] text-white",children:[e.jsxs("section",{ref:n,className:"mx-auto max-w-6xl px-4 pt-10 pb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-white/60",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{children:"beta"})]}),e.jsxs("h1",{className:"mt-3 text-3xl sm:text-4xl font-bold tracking-tight",children:["Портал проекта ",e.jsx("span",{className:"text-sky-400",children:"SKY"})]}),e.jsx("p",{className:"mt-2 text-white/70 max-w-2xl",children:"Добро пожаловать! Здесь быстрые ссылки, чат и полезные разделы для команды."}),e.jsx("div",{className:"mt-5 flex flex-wrap gap-2",children:G.map(a=>e.jsxs(B,{to:a.to,className:"inline-flex items-center gap-2 rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-sm hover:bg-white/10 transition",children:[a.icon,a.label,e.jsx(H,{className:"w-3.5 h-3.5 opacity-70"})]},a.to))})]}),e.jsx("section",{className:"mx-auto max-w-6xl px-4 pb-6",children:e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:Z.map((a,u)=>e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 backdrop-blur hover:border-white/20 transition",children:[e.jsx("div",{className:"mb-2 inline-flex rounded-lg bg-white/10 p-2",children:a.icon}),e.jsx("div",{className:"font-semibold",children:a.title}),e.jsx("div",{className:"mt-1 text-sm text-white/70",children:a.text})]},u))})}),e.jsx("section",{className:"mx-auto max-w-6xl px-4 pb-10",children:e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-sky-300"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Командный чат"})]}),e.jsx(X,{room:"global",className:"bg-transparent border-0 p-0"}),e.jsx("p",{className:"mt-2 text-xs text-white/50",children:"Админ назначается автоматически после входа по секретной ссылке."})]})})]})}export{re as default};
